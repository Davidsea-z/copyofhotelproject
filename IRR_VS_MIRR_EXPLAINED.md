# IRR vs MIRR：为什么考虑复投要使用 MIRR？

## 问题发现

在实现 IRR 复投功能时，我们发现了一个重要的数学问题：

**标准 IRR 公式中，考虑复投和不考虑复投，计算结果是一样的！**

### 数学证明

#### 标准 IRR（不考虑复投）
```
NPV = -PV + Σ(CF_t / (1+IRR)^t) = 0
```

#### "复投" IRR（错误理解）
```
NPV = -PV + [Σ(CF_t × (1+IRR)^(T-t))] / (1+IRR)^T = 0
```

#### 简化后
```
Σ(CF_t × (1+IRR)^(T-t)) / (1+IRR)^T 
= Σ(CF_t × (1+IRR)^(T-t) × (1+IRR)^(-T))
= Σ(CF_t × (1+IRR)^(-t))
= Σ(CF_t / (1+IRR)^t)
```

**结论**：两个公式**完全等价**！这就是为什么考虑复投和不考虑复投的 IRR 一样。

## 正确的解决方案：MIRR

### 什么是 MIRR？

**MIRR (Modified Internal Rate of Return)** = **修正内部收益率**

MIRR 解决了标准 IRR 的两个关键问题：

1. **再投资收益率假设不合理**
   - 标准 IRR 假设：所有现金流按 IRR 本身再投资
   - 问题：如果 IRR = 50%，意味着每笔回收的钱都能继续赚 50%，这不现实
   
2. **多重 IRR 问题**
   - 当现金流有多次正负转换时，可能有多个 IRR 解
   - MIRR 总是唯一的

### MIRR 计算方法

```
MIRR = (FV / PV)^(1/n) - 1
```

其中：
- **FV (Future Value)** = 所有现金流入按**再投资收益率**复利到期末的总和
- **PV (Present Value)** = 初始投资（现值）
- **n** = 项目期限（年）
- **再投资收益率** = 现实的再投资机会收益率（如 18%）

### 计算示例

#### 参数
- 初始投资：100万元
- 日 PCF：2,000元
- YITO 期限：660天（1.808年）
- 再投资收益率：18%

#### 计算步骤

**步骤1：计算每笔现金流的期末终值**
```
第1天的 2,000 元 → 2,000 × (1.18)^(1.808-1/365) = 2,750.8 元
第2天的 2,000 元 → 2,000 × (1.18)^(1.808-2/365) = 2,749.5 元
...
第660天的 2,000 元 → 2,000 × (1.18)^0 = 2,000 元
```

**步骤2：计算总终值 (FV)**
```
FV = 2,750.8 + 2,749.5 + ... + 2,000 ≈ 1,503,820 元
```

**步骤3：计算 MIRR**
```
MIRR = (1,503,820 / 1,000,000)^(1/1.808) - 1
     = (1.50382)^0.5531 - 1
     = 1.2448 - 1
     = 0.2448 = 24.48%
```

### IRR vs MIRR 对比

| 指标 | 标准 IRR | MIRR（再投资率18%） | 差异 |
|------|---------|-------------------|------|
| 日分账 | ~18% | ~24% | **+6%** |
| 周分账 | ~18% | ~23% | **+5%** |
| 双周分账 | ~18% | ~22% | **+4%** |

## 为什么 MIRR 更合理？

### 1. 现实的再投资假设
- ❌ IRR 假设：每笔现金流都能按 50% 再投资（不现实）
- ✅ MIRR 假设：每笔现金流按 18% 再投资（符合市场预期）

### 2. 反映真实投资环境
- 投资者实际上会将回收的资金投入到其他收益率约 18% 的项目
- MIRR 反映了这种现实情况下的真实回报

### 3. 更保守的估计
- MIRR 通常低于 IRR
- 提供更保守、更可靠的投资回报预期

## 实际意义

### 对投资者
- **更准确的决策依据**：MIRR 考虑了再投资现实，提供更可靠的回报预期
- **风险评估**：通过调整再投资率，可以评估不同市场环境下的回报

### 对项目评估
- **比较不同项目**：MIRR 使得不同期限、不同现金流模式的项目可比性更强
- **更符合企业财务实践**：企业通常有明确的资金成本和再投资收益率

## 使用建议

### 何时使用 MIRR？
✅ **推荐使用 MIRR**：
- 评估长期投资项目（>1年）
- 现金流分期回收且可以再投资
- 需要考虑再投资机会的实际收益
- 对比不同规模和期限的项目

### 何时使用 IRR？
✅ **使用标准 IRR**：
- 短期项目（<1年）
- 单一回收期（如到期一次性回收）
- 纯粹评估项目本身的收益率
- 不考虑再投资场景

## 我们的实现

### 代码逻辑

```javascript
function calculateMIRR(initialInvestment, cashFlows, reinvestmentRate, daysPerYear) {
    // 1. 获取项目总期限
    const maxDays = Math.max(...cashFlows.map(f => f.days));
    const maxYears = maxDays / daysPerYear;
    
    // 2. 计算所有现金流的期末终值
    let futureValue = 0;
    for (const flow of cashFlows) {
        const t = flow.days / daysPerYear;
        const remainingYears = maxYears - t;
        // 按再投资率复利到期末
        futureValue += flow.amount * Math.pow(1 + reinvestmentRate, remainingYears);
    }
    
    // 3. 计算 MIRR
    return Math.pow(futureValue / initialInvestment, 1 / maxYears) - 1;
}
```

### 用户控制

- **复选框**：「考虑复投（MIRR修正IRR）」
- **再投资率**：使用「预期年收益率」（18%）
- **默认状态**：启用（更符合实际投资场景）

## 总结

| 特性 | IRR | MIRR |
|------|-----|------|
| 再投资假设 | 按 IRR 本身 | 按现实收益率 |
| 计算复杂度 | 需迭代求解 | 直接公式计算 |
| 结果唯一性 | 可能多解 | 总是唯一 |
| 现实性 | 较理想化 | 更符合实际 |
| 适用场景 | 项目本身收益 | 考虑再投资场景 |

**关键结论**：
- ✅ **考虑复投 = 使用 MIRR**
- ✅ **不考虑复投 = 使用标准 IRR**
- ✅ **MIRR 更符合实际投资环境**

---

**文档版本**：v2.3  
**更新日期**：2026-02-09  
**作者**：MICROCONNECT AI
